/*
 * Copyright (C) 2018-2019 Zhiyi Zhang
 *
 * This file is subject to the terms and conditions of the GNU Lesser
 * General Public License v2.1. See the file LICENSE in the top level
 * directory for more details.
 */

#include "hmac-tests.h"
#include "ndn-lite/security/ndn-lite-hmac.h"
#include <string.h>

bool
run_test_case_1()
{
  uint8_t secret[] = {
    0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,
    0x0b,0x0b,0x0b,0x0b
  };
  uint8_t salt[] = {0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c};
  uint8_t info[] = {0xf0,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9};
  uint8_t result[42] = {0};
  uint8_t expected[] = {0x3c,0xb2,0x5f,0x25,0xfa,0xac,0xd5,0x7a,0x90,0x43,
                        0x4f,0x64,0xd0,0x36,0x2f,0x2a,0x2d,0x2d,0x0a,0x90,
                        0xcf,0x1a,0x5a,0x4c,0x5d,0xb0,0x2d,0x56,0xec,0xc4,
                        0xc5,0xbf,0x34,0x00,0x72,0x08,0xd5,0xb8,0x87,0x18,
                        0x58,0x65};
  int ret = ndn_hkdf(secret, sizeof(secret), result, 42, salt, sizeof(salt), info, sizeof(info));
  if (ret != 0) {
    printf("HMAC run_test_case_1: HKDF function fails with return value %d", ret);
    return false;
  }
  if (memcmp(result, expected, 42) != 0) {
    printf("HMAC run_test_case_1: HKDF function logic is wrong");
    return false;
  }
  printf("\nHMAC run_test_case_1: SUCCEED");
  return true;
}

bool
run_test_case_2()
{
  uint8_t secret[] = {
    0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,0x0b,
    0x0b,0x0b,0x0b,0x0b
  };
  uint8_t result[42] = {0};
  uint8_t expected[] = {0x8d,0xa4,0xe7,0x75,0xa5,0x63,0xc1,0x8f,0x71,0x5f,0x80,0x2a,0x06,0x3c,0x5a,0x31,
          0xb8,0xa1,0x1f,0x5c,0x5e,0xe1,0x87,0x9e,0xc3,0x45,0x4e,0x5f,0x3c,0x73,0x8d,0x2d,
          0x9d,0x20,0x13,0x95,0xfa,0xa4,0xb6,0x1a,0x96,0xc8};
  int ret = ndn_hkdf(secret, sizeof(secret), result, 42, NULL, 0, NULL, 0);
  if (ret != 0) {
    printf("HMAC run_test_case_2: HKDF function fails with return value %d", ret);
    return false;
  }
  if (memcmp(result, expected, 42) != 0) {
    printf("HMAC run_test_case_2: HKDF function logic is wrong");
    return false;
  }
  printf("\nHMAC run_test_case_2: SUCCEED");
  return true;
}

bool
run_hmac_tests(void)
{
  bool result1 = run_test_case_1();
  bool result2 = run_test_case_2();
  return result1 && result2;
}